# ğŸ—ï¸ Architecture Rules

## Project Structure

This is a **NestJS Blog API** with modular architecture:

```
src/
â”œâ”€â”€ core/             # Essential business functionality
â”œâ”€â”€ modules/          # Domain-specific features  
â”œâ”€â”€ common/           # Shared utilities
â”œâ”€â”€ cli/              # Database management commands
â”œâ”€â”€ config/           # Environment configuration
â””â”€â”€ utils/            # Helper functions
```

## Module Boundaries

### Core Modules (`src/core/`)
**Purpose**: Essential business-critical functionality that the entire app depends on

**Current modules**:
- `auth/` - Authentication & JWT  
- `users/` - User management
- `permissions/` - Role-based access control
- `audit/` - Activity tracking

**Rules**:
- âœ… Core modules can depend on `common/` utilities
- âœ… Core modules can depend on other core modules
- âŒ Core modules CANNOT depend on feature modules
- âœ… Contains business-critical functionality
- âœ… If removing it breaks fundamental app functionality â†’ it's core

### Feature Modules (`src/modules/`)
**Purpose**: Domain-specific business features

**Current modules**:
- `user/` - User-related features (should move to core)

**Rules**:
- âœ… Feature modules can depend on `core/` modules
- âœ… Feature modules can depend on `common/` utilities  
- âŒ Feature modules CANNOT depend on other feature modules
- âœ… Contains nice-to-have business features
- âœ… Removing it doesn't break core functionality

### Common Utilities (`src/common/`)
**Purpose**: Shared infrastructure and utilities

**Structure**:
- `prisma/` - Database service & health checks
- `guards/` - Authentication guards
- `decorators/` - Custom decorators
- `services/` - Utility services
- `modules/` - Module loading system

**Rules**:
- âœ… No dependencies on core or feature modules
- âœ… Framework/infrastructure related only
- âŒ NO business logic allowed
- âœ… Can be used by any module

## Dynamic Module Loading

**System**: Automatic module discovery and loading

**How it works**:
```typescript
// Modules are discovered automatically from:
// - src/core/*/module-name.module.ts  
// - src/modules/*/module-name.module.ts

// No manual imports needed in app.module.ts
```

**Rules**:
- âœ… Module files MUST follow naming: `*.module.ts`
- âœ… Modules MUST be in correct directories
- âœ… Use `@Module()` decorator properly
- âœ… Export public APIs via `index.ts`

## Dependency Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Feature   â”‚â—„â”€â”€â”€â”¤    Core     â”‚
â”‚   Modules   â”‚    â”‚   Modules   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Common Utilities         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Rules**:
- âœ… Dependencies flow downward only
- âœ… Core modules can reference each other
- âŒ No circular dependencies allowed
- âœ… Use dependency injection for all services

## Module Structure Standards

Each module MUST have:
```
module-name/
â”œâ”€â”€ *.interface.ts    # Data contracts
â”œâ”€â”€ *.repository.ts   # Data access layer
â”œâ”€â”€ *.service.ts      # Business logic
â”œâ”€â”€ *.module.ts       # NestJS module
â”œâ”€â”€ dto/              # Input/output types
â”œâ”€â”€ index.ts          # Public API exports
â””â”€â”€ *.prisma          # Schema (core modules only)
```

Optional files:
- `*.resolver.ts` - GraphQL resolvers
- `*.controller.ts` - REST controllers  
- `*.guard.ts` - Custom guards
- `entities/` - Domain entities

## Path Aliases

**Configuration**: Defined in `tsconfig.json`

```typescript
// Use these imports:
import { UserService } from '@core/users';
import { PrismaService } from '@common/prisma';
import { jwtConfig } from '@config/jwt.config';

// NOT relative paths in most cases:
import { UserService } from '../../core/users/user.service';
```

**Rules**:
- âœ… Use path aliases for cross-module imports
- âœ… CLI uses relative paths (TypeScript limitation)
- âœ… Keep aliases consistent with folder structure
- âŒ Don't mix alias and relative imports in same file
``` 